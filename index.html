<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LastWar S5 Coffee Calc</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500;700&family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <header>
        <h1><span data-t="title">コーヒー生産計算機</span> <span class="subtitle">LastWar S5 Coffee Calc</span></h1>
        <div class="lang-switch">
            <img src="https://flagcdn.com/w80/jp.png" class="flag-icon active" onclick="app.setLang('ja')" alt="JP">
            <img src="https://flagcdn.com/w80/us.png" class="flag-icon" onclick="app.setLang('en')" alt="EN">
        </div>
    </header>

    <div class="card">
        <h2>
            <span data-t="h_prod">生産設定</span>
            <span id="total-prod" class="font-mono text-primary" style="font-size:1.1rem;">0/h</span>
        </h2>
        <div class="grid cols-4" id="factory-area">
            </div>
        <div class="grid cols-2 mt-md">
            <div>
                <label data-t="weekly">週間配達</label>
                <select id="weekly-lv" onchange="app.calc()"></select>
            </div>
            <div>
                <label style="white-space: nowrap;">
                    <span data-t="time">現在時刻</span>
                    <span id="now-date" style="margin-left: 8px; color: #5D4037; font-weight: bold;"></span>
                </label>
                <div class="time-wrapper">
                    <input type="time" id="now-time" onchange="app.calc()">
                    <button class="btn-now" onclick="app.setNow()" data-t="btn_now">現在</button>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2 data-t="h_status">目標設定（カフェイン研究所）</h2>
        <div class="grid cols-2">
            <div>
                <label data-t="cur_lv">現在 Lv</label>
                <select id="lab-cur" onchange="app.onCurChange()"></select>
            </div>
            <div>
                <label data-t="tgt_lv">目標 Lv</label>
                <select id="lab-tgt" onchange="app.calc()"></select>
            </div>
            <div>
                <label data-t="stock">保有量</label>
                <input type="text" id="stock" placeholder="0 (1K, 1M...)" 
                       onfocus="this.select()" oninput="app.calc()" 
                       enterkeyhint="done">
            </div>
            <div>
                <label data-t="disc">割引率 (%)</label>
                <select id="discount" onchange="app.calc()"></select>
            </div>
        </div>
    </div>

    <div class="card">
        <h2 data-t="h_buff">コーヒーバフ (ウイルス耐性)</h2>
        <div class="grid cols-2 checkbox-group">
            <label>
                <input type="checkbox" id="buff-250" onchange="app.toggleBuff(250)">
                <span>+250</span>
            </label>
            <label>
                <input type="checkbox" id="buff-500" onchange="app.toggleBuff(500)">
                <span>+500</span>
            </label>
        </div>
    </div>

    <div class="card result-card">
        <h2 data-t="h_res">計算結果</h2>
        <div class="res-row">
            <span data-t="r_daily">日産 (24h)</span>
            <span class="res-val" id="res-daily">0</span>
        </div>
        <div class="res-row">
            <span data-t="r_cost">必要総数</span>
            <span class="res-val" id="res-cost">0</span>
        </div>
        <div class="res-row">
            <span data-t="r_virus">ウイルス耐性</span>
            <span class="res-val" id="res-virus">0 → 0</span>
        </div>
        
        <div class="highlight-box">
            <div id="status-msg" style="font-weight:bold; font-size:0.9rem;">入力待ち</div>
            
            <span class="big-time font-mono" id="res-time">--:--</span>
            <span class="big-date" id="res-date">--/--</span>
            
            <div class="shortage-area">
                <span data-t="r_short" style="font-size:0.85rem; font-weight:bold;">不足</span>
                <span id="res-short" class="font-mono" style="font-size:1.3rem; font-weight:900;">0</span>
            </div>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn btn-save" onclick="app.save()" data-t="btn_save">設定を保存</button>
        <button class="btn btn-reset" onclick="app.reset()" data-t="btn_reset">リセット</button>
    </div>

    <div style="margin-top: 30px; text-align: center;">
        <button onclick="app.toggleAdmin()" style="background:none; border:none; color:#999; text-decoration:underline; font-size:0.8rem; cursor:pointer;">
            管理者モード (データ編集)
        </button>
    </div>

    <div id="admin-panel" class="card" style="display:none; margin-top:10px; border: 2px solid #ccc; background: #fff;">
        <h3 style="margin-top:0;">データ編集</h3>
        <p style="font-size:0.8rem; color:#666;">カンマ区切りで数値を入力してください。</p>
        
        <div style="margin-bottom:15px;">
            <label style="display:block; font-weight:bold;">必要量 (Required Amount)</label>
            <textarea id="admin-costs" style="width:100%; height:100px; font-family:monospace; font-size:0.8rem;"></textarea>
        </div>

        <div style="margin-bottom:15px;">
            <label style="display:block; font-weight:bold;">ウイルス (VIRUS)</label>
            <textarea id="admin-virus" style="width:100%; height:60px; font-family:monospace; font-size:0.8rem;"></textarea>
        </div>

        <div class="btn-group">
            <button class="btn" style="background:#2196F3; color:white;" onclick="app.saveAdmin()">データを適用して保存</button>
            <button class="btn" style="background:#ccc; color:#333;" onclick="app.resetAdmin()">初期値に戻す</button>
        </div>
        <button onclick="app.toggleAdmin()" style="margin-top:10px; width:100%; padding:10px;">閉じる</button>
    </div>
</div>

<script src="script.js"></script>
</body>
</html>
